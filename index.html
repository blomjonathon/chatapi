<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>New Central Auto Body - Invoice Creator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        #invoiceBox {
            max-width: 800px;
            margin: auto;
            padding: 30px;
            border: 1px solid #eee;
        }

        h1 {
            text-align: center;
        }

        .section {
            margin-bottom: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        table,
        th,
        td {
            border: 1px solid #ddd;
        }

        th,
        td {
            padding: 10px;
            text-align: left;
        }

        .totals {
            text-align: right;
            margin-top: 20px;
        }

        .notes {
            margin-top: 30px;
        }

        .btn {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <h1>Create Invoice</h1>

    <div class="section">
        <h3>Vehicle Info</h3>
        <label>Year: <input type="text" id="year"></label>
        <label>Make: <input type="text" id="make"></label>
        <label>Model: <input type="text" id="model"></label>
        <label>VIN: <input type="text" id="vin"></label>
        <label>RO#: <input type="text" id="ro"></label>
    </div>

    <div class="section">
        <h3>Select Manufacturer:</h3>
        <select id="makeSelect" onchange="loadCalibrations()">
            <option value="">-- Select Make --</option>
            <option value="Honda/Acura">Honda/Acura</option>
            <option value="BMW">BMW</option>
            <option value="Chrysler">Chrysler</option>
            <option value="Ford">Ford</option>
            <option value="GM">GM</option>
            <option value="Hyundai">Hyundai</option>
            <option value="Kia">Kia</option>
            <option value="Lexus/Toyota">Lexus/Toyota</option>
            <option value="Mazda">Mazda</option>
            <option value="Nissan/Infiniti">Nissan/Infiniti</option>
            <option value="Subaru">Subaru</option>
            <option value="Volkswagen">Volkswagen</option>
        </select>
    </div>

    <div class="section">
        <h3>Available Calibrations:</h3>
        <div id="calibrationOptions"></div>
    </div>

    <button class="btn" onclick="generateInvoice()">Generate Invoice</button>
    <button class="btn" onclick="downloadPDF()">Download PDF</button>

    <div id="invoiceBox">
        <h1>INVOICE</h1>

        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
            <div>
                <p><strong>New Central Auto Body</strong></p>
                <p>4737 Nicollet Ave, Minneapolis, MN 55419, USA</p>
                <p>Email: newcentralautobody@example.com</p>
                <p>Invoice #: <span id="invoiceNumber"></span></p>
                <p>Invoice Date: <span id="invoiceDate"></span></p>
                <p>Terms: Due on Receipt</p>
                <p>Due Date: <span id="dueDate"></span></p>
            </div>
            <div>
                <!-- <img src="./assets/images/inv.jpg" alt="Logo" style="max-width: 150px; height: auto;"> -->
            </div>
        </div>

        <div>
            <h3>Bill To:</h3>
            <p>New Central Auto Body</p>
            <p>4737 Nicollet Ave, Minneapolis, MN 55419</p>
            <p>USA</p>
        </div>

        <div>
            <h3>Vehicle Information:</h3>
            <p>Year/Make/Model: <span id="vehicle"></span></p>
            <p>VIN: <span id="vehicleVin"></span></p>
            <p>RO#: <span id="vehicleRo"></span></p>
        </div>

        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Item & Description</th>
                    <th>Qty</th>
                    <th>Rate</th>
                    <th>Amount</th>
                </tr>
            </thead>
            <tbody id="itemsTable"></tbody>
        </table>

        <div class="totals">
            <p>Sub Total: $<span id="subTotal">0.00</span></p>
            <p><strong>Total: $<span id="total">0.00</span></strong></p>
            <p><strong>Balance Due: $<span id="balanceDue">0.00</span></strong></p>
        </div>

        <div class="notes">
            <p><strong>Notes:</strong></p>
            <p>Thanks for your business.</p>
        </div>
    </div>

    <!-- html2pdf Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <script>
        const calibrationsByMake = {
            "Honda/Acura": [
                { name: "Pre-Repair Scan", price: 120 },
                { name: "Post-Repair Scan", price: 120 },
                { name: "Calibrate - Occupant Classification System - Passenger Seat", price: 166 },
                { name: "Calibrate - Forward RADAR (Adaptive Cruise System)", price: 394 },
                { name: "Calibrate – LaneWatch Camera – Honda", price: 378 },
                { name: "Calibrate - Blind Spot Monitoring System BSM", price: 486 },
                { name: "Calibrate - ABS & VSA Sensor Relearn", price: 248 }
            ],
            "BMW": [
                { name: "Pre-Repair Scan", price: 120 },
                { name: "Post-Repair Scan", price: 120 },
                { name: "Program - Global Vehicle – Headlamp Calibration", price: 226 },
                { name: "Program - Global Vehicle – Module Calibration", price: 226 },
                { name: "Initialize - Liftgate", price: 106 }
            ],
            "Chrysler": [
                { name: "Pre-Repair Scan", price: 120 },
                { name: "Post-Repair Scan", price: 120 },
                { name: "Calibrate – Forward Camera – Dynamic", price: 330 }
            ],
            "Ford": [
                { name: "Pre-Repair Scan", price: 120 },
                { name: "Post-Repair Scan", price: 120 },
                { name: "Calibrate – Park Assist", price: 394 },
                { name: "Calibrate – Blind Spot Monitoring System BSM", price: 486 }
            ],
            "GM": [
                { name: "Pre-Repair Scan", price: 120 },
                { name: "Post-Repair Scan", price: 120 },
                { name: "Calibrate - Forward RADAR (Adaptive Cruise System)", price: 444 }
            ],
            "Hyundai": [
                { name: "Pre-Repair Scan", price: 120 },
                { name: "Post-Repair Scan", price: 120 },
                { name: "Calibrate - Forward RADAR (Adaptive Cruise)", price: 394 }
            ],
            "Kia": [
                { name: "Pre-Repair Scan", price: 120 },
                { name: "Post-Repair Scan", price: 120 },
                { name: "Calibrate - Forward Camera Eyesight - Static", price: 386 }
            ],
            "Lexus/Toyota": [
                { name: "Pre-Repair Scan", price: 120 },
                { name: "Post-Repair Scan", price: 120 },
                { name: "Calibrate – Occupant Classification System – Passenger Seat", price: 184 },
                { name: "Inspect ECU – OCS Passenger Seat", price: 90 },
                { name: "Calibrate - Forward RADAR (Adaptive Cruise System)", price: 394 },
                { name: "Calibrate – Park Assist", price: 392 }
            ],
            "Mazda": [
                { name: "Pre-Repair Scan", price: 120 },
                { name: "Post-Repair Scan", price: 120 },
                { name: "Calibrate - Forward Camera - Dynamic", price: 290 },
                { name: "Calibrate - Forward RADAR (Adaptive Cruise System)", price: 442 },
                { name: "Calibrate - ABS & VSA Sensor Relearn", price: 248 }
            ],
            "Nissan/Infiniti": [
                { name: "Pre-Repair Scan", price: 120 },
                { name: "Post-Repair Scan", price: 120 },
                { name: "Calibrate - Forward RADAR (Adaptive Cruise)", price: 446 },
                { name: "Calibrate - Birds Eye Camera", price: 256 },
                { name: "Inspect – Steering Column", price: 210 }
            ],
            "Subaru": [
                { name: "Pre-Repair Scan", price: 120 },
                { name: "Post-Repair Scan", price: 120 },
                { name: "Calibrate – Forward Camera – Static", price: 346 },
                { name: "Calibrate – Blind Spot Monitoring System BSM", price: 486 }
            ],
            "Volkswagen": [
                { name: "Pre-Repair Scan", price: 120 },
                { name: "Post-Repair Scan", price: 120 },
                { name: "Initialize - Power Windows", price: 105 },
                { name: "Calibrate - Forward RADAR (Adaptive Cruise System)", price: 394 }
            ]
        };

        let selectedCalibrations = [];
        let invoiceCounter = 1;

        function loadCalibrations() {
            const make = document.getElementById('makeSelect').value;
            const optionsDiv = document.getElementById('calibrationOptions');
            optionsDiv.innerHTML = "";

            if (!make || !calibrationsByMake[make]) return;

            calibrationsByMake[make].forEach((service, index) => {
                optionsDiv.innerHTML += `
      <label><input type="checkbox" value="${index}" onchange="toggleCalibration('${make}', ${index})"> ${service.name} - $${service.price.toFixed(2)}</label><br>
    `;
            });
        }

        function toggleCalibration(make, index) {
            const service = calibrationsByMake[make][index];
            const found = selectedCalibrations.find(item => item.name === service.name);
            if (found) {
                selectedCalibrations = selectedCalibrations.filter(item => item.name !== service.name);
            } else {
                selectedCalibrations.push({ ...service, qty: 1 });
            }
        }

        function generateInvoice() {
            if (selectedCalibrations.length === 0) {
                alert('Please select at least one calibration.');
                return;
            }

            document.getElementById('invoiceBox').style.display = 'block';

            const year = document.getElementById('year').value;
            const make = document.getElementById('make').value;
            const model = document.getElementById('model').value;
            const vin = document.getElementById('vin').value;
            const ro = document.getElementById('ro').value;

            document.getElementById('vehicle').innerText = `${year} ${make} ${model}`;
            document.getElementById('vehicleVin').innerText = vin;
            document.getElementById('vehicleRo').innerText = ro;

            const today = new Date();
            const dateStr = today.toLocaleDateString();
            const invNum = "INV-" + invoiceCounter.toString().padStart(6, '0');

            document.getElementById('invoiceDate').innerText = dateStr;
            document.getElementById('dueDate').innerText = dateStr;
            document.getElementById('invoiceNumber').innerText = invNum;

            const table = document.getElementById('itemsTable');
            table.innerHTML = '';
            let subTotal = 0;

            selectedCalibrations.forEach((item, index) => {
                let amount = item.qty * item.price;
                subTotal += amount;
                table.innerHTML += `
      <tr>
        <td>${index + 1}</td>
        <td>${item.name}</td>
        <td>${item.qty.toFixed(2)}</td>
        <td>$${item.price.toFixed(2)}</td>
        <td>$${amount.toFixed(2)}</td>
      </tr>
    `;
            });

            document.getElementById('subTotal').innerText = subTotal.toFixed(2);
            document.getElementById('total').innerText = subTotal.toFixed(2);
            document.getElementById('balanceDue').innerText = subTotal.toFixed(2);
        }
function addCustomCalibration() {
    const make = document.getElementById('makeSelect').value;
    const name = document.getElementById('customName').value.trim();
    const price = parseFloat(document.getElementById('customPrice').value);

    if (!make) {
        alert("Please select a manufacturer first.");
        return;
    }
    if (!name || isNaN(price)) {
        alert("Please enter a valid name and price.");
        return;
    }

    if (!calibrationsByMake[make]) {
        calibrationsByMake[make] = [];
    }

    calibrationsByMake[make].push({ name: name, price: price });
    loadCalibrations(); // reload the list
    document.getElementById('customName').value = '';
    document.getElementById('customPrice').value = '';
}

function loadCalibrations() {
    const make = document.getElementById('makeSelect').value;
    const optionsDiv = document.getElementById('calibrationOptions');
    optionsDiv.innerHTML = "";

    if (!make || !calibrationsByMake[make]) return;

    calibrationsByMake[make].forEach((service, index) => {
        optionsDiv.innerHTML += `
        <div style="margin-bottom: 8px;">
            <input type="checkbox" value="${index}" onchange="toggleCalibration('${make}', ${index})">
            <input type="text" value="${service.name}" onchange="editCalibrationName('${make}', ${index}, this.value)" style="width: 50%;">
            $<input type="number" value="${service.price.toFixed(2)}" onchange="editCalibrationPrice('${make}', ${index}, this.value)" style="width: 80px;">
        </div>
        `;
    });
}
        function downloadPDF() {
            const invoice = document.getElementById('invoiceBox');
            html2pdf().from(invoice).save('Invoice.pdf');
        }
    </script>

</body>

</html>
